<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather & Clock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="icon" id="favicon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABMSURBVHgBnY4xCoAwEETf3xG3zK1TzBvo1NpsQnJ36rO+q3fBCEe6g+CgO2yqU05y1mY1p7zR8A22A9n+o9r/h+Uf93+B8/2LgQoAAAC+aK+k1U32C4bAAAAAElFTkSuQmCC">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #000000; /* Solid black background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #e2e8f0; /* Light text color */
        }

        .widget-container {
            /* Light grey gradient for the main foreground tile */
            background: linear-gradient(135deg, rgba(200, 200, 200, 0.1), rgba(240, 240, 240, 0.1));
            backdrop-filter: blur(20px) saturate(180%); /* Frosted glass effect */
            -webkit-backdrop-filter: blur(20px) saturate(180%); /* Safari support */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            width: 100%; /* Takes full width up to max-width */
            max-width: 900px; /* Fixed maximum width for desktop view, as per screenshot */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: row; /* Always arrange tiles in a row for desktop-like view */
            flex-wrap: wrap; /* Allow tiles to wrap if screen is too small */
            justify-content: center; /* Center items within the container */
            align-items: stretch; /* IMPORTANT: Ensures flex items (tiles) stretch to the same height */
            gap: 25px; /* Consistent gap between tiles */
            position: relative;
            overflow: hidden; /* Ensures blur doesn't bleed */
        }

        .widget-tile {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1; /* Allow tiles to grow and shrink */
            min-width: 280px; /* Minimum width for weather/forecast tiles before wrapping */
            max-width: 100%; /* Ensures tiles don't overflow their container */
        }

        .widget-tile.clock-tile {
            flex-basis: 100%; /* Clock tile always takes full width of the container */
            max-width: 100%;
        }

        /* For weather and forecast tiles, make them roughly half width */
        .widget-tile:not(.clock-tile) {
            flex-basis: calc(50% - 12.5px); /* Approximately 50% minus half the gap (25px / 2 = 12.5px) */
            max-width: calc(50% - 12.5px);
        }

        /* Mobile adjustments: stacking tiles */
        @media (max-width: 767px) {
            .widget-container {
                flex-direction: column; /* Stack vertically on small screens */
                padding: 20px;
                gap: 20px;
            }
            .widget-tile,
            .widget-tile:not(.clock-tile),
            .widget-tile.clock-tile { /* Reset specific widths for mobile */
                min-width: 100%; /* All tiles take full width on small screens */
                max-width: 100%;
                flex-basis: auto; /* Allow flex to determine size based on content and available space */
                padding: 15px;
            }
            .clock-time {
                font-size: 2.8rem;
            }
            .clock-date {
                font-size: 1rem;
            }
            .weather-current-temp {
                font-size: 2rem;
            }
        }

        .widget-tile.gradient-1 {
            background: linear-gradient(135deg, rgba(66, 153, 225, 0.2), rgba(66, 153, 225, 0.05)); /* Blue-ish gradient */
        }

        .widget-tile.gradient-2 {
            background: linear-gradient(135deg, rgba(49, 196, 141, 0.2), rgba(49, 196, 141, 0.05)); /* Green-ish gradient */
        }

        .widget-tile.gradient-3 {
            background: linear-gradient(135deg, rgba(237, 137, 54, 0.2), rgba(237, 137, 54, 0.05)); /* Orange-ish gradient */
        }

        .clock-time {
            font-size: 3.5rem;
            font-weight: 700;
            letter-spacing: -0.05em;
            text-align: center;
            color: #a7f3d0; /* Light green for time */
            text-shadow: 0 0 15px rgba(167, 243, 208, 0.4);
        }

        .clock-date {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            color: #cbd5e0;
        }

        .special-day {
            font-size: 1rem;
            font-weight: 400;
            text-align: center;
            color: #fcba03; /* Amber for special day */
            margin-top: 5px;
        }

        .weather-current-temp {
            font-size: 2.5rem;
            font-weight: 600;
            color: #90cdf4; /* Light blue for temperature */
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weather-detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: #cbd5e0;
        }

        .weather-forecast-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .weather-forecast-item:first-child {
            border-top: none;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #a0aec0;
            width: 100%; /* Ensure footer spans full width */
        }
    </style>
</head>
<body>
    <div class="widget-container">
        <div class="widget-tile gradient-1 clock-tile">
            <div id="clock-time" class="clock-time">--:--:-- --</div>
            <div id="clock-date" class="clock-date">Loading Date...</div>
            <div id="special-day" class="special-day hidden"></div>
        </div>

        <div class="widget-tile gradient-2">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-xl font-semibold text-white">Current Weather</h3>
                <span id="weather-location" class="text-sm text-gray-400">Thiruvananthapuram, Kerala</span>
            </div>
            <div id="current-weather-display" class="flex flex-col gap-2">
                <div class="weather-current-temp">
                    <span id="current-temp">--¬∞C</span>
                    <span id="weather-emoji" class="text-4xl"></span>
                    <span id="weather-description" class="text-xl font-medium text-gray-300"></span>
                </div>
                <div class="grid grid-cols-2 gap-y-2 gap-x-4 text-sm">
                    <div class="weather-detail-item"><span class="text-lg">üí®</span> Wind: <span id="wind-speed">-- km/h</span></div>
                    <div class="weather-detail-item"><span class="text-lg">üíß</span> Humidity: <span id="humidity">--%</span></div>
                    <div class="weather-detail-item"><span class="text-lg">üåßÔ∏è</span> Rainfall: <span id="rainfall">-- mm</span></div>
                    <div class="weather-detail-item"><span class="text-lg">‚òÅÔ∏è</span> AQI: <span id="aqi">--</span></div>
                </div>
            </div>
            <div id="current-weather-loading" class="text-center text-gray-400">Loading current weather...</div>
            <div id="current-weather-error" class="text-center text-red-400 hidden">Error loading weather.</div>
        </div>

        <div class="widget-tile gradient-3">
            <h3 class="text-xl font-semibold text-white mb-2">Next 3 Days Forecast</h3>
            <div id="forecast-display" class="flex flex-col">
                </div>
            <div id="forecast-loading" class="text-center text-gray-400">Loading forecast...</div>
            <div id="forecast-error" class="text-center text-red-400 hidden">Error loading forecast.</div>
        </div>

        <div class="footer">
            Made with ‚ù§Ô∏è by Naveen.
        </div>
    </div>

    <script>
        // --- Wake Lock API ---
        let wakeLock = null;

        const requestWakeLock = async () => {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('Wake Lock is active!');
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        };

        // Request wake lock when the tab becomes active
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                requestWakeLock();
            } else if (wakeLock !== null) {
                wakeLock.release();
                wakeLock = null;
            }
        });

        // Request wake lock on load
        window.onload = () => {
            if ('wakeLock' in navigator) {
                requestWakeLock();
            } else {
                console.warn('Wake Lock API not supported in this browser.');
            }
            updateClock();
            fetchWeather();
        };

        // --- Clock and Date ---
        function updateClock() {
            const now = new Date();

            // Digital Clock (12-hour format with seconds and AM/PM)
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // The hour '0' should be '12'
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes}:${seconds} ${ampm}`;
            document.getElementById('clock-time').textContent = timeString;

            // Date (Indian Calendar)
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('en-IN', options); // 'en-IN' for Indian locale
            document.getElementById('clock-date').textContent = dateString;

            // Special Day Check (Hardcoded for demonstration)
            checkSpecialDay(now);
        }

        const specialDays = {
            // Example special days (Month is 0-indexed: Jan=0, Feb=1, etc.)
            "1-26": "Republic Day üáÆüá≥",
            "8-15": "Independence Day üáÆüá≥",
            "9-2": "Onam üåæ", // Example for 2025, adjust as needed
            "9-23": "Dussehra / Vijayadashami ‚ú®", // Example for 2025
            "10-2": "Gandhi Jayanti üïäÔ∏è",
            "10-21": "Diwali ü™î", // Example for 2025
            "11-1": "Kerala Piravi üå¥",
            "11-15": "Children's Day üë∂",
            "12-25": "Christmas üéÑ"
        };

        function checkSpecialDay(date) {
            const monthDay = `${date.getMonth()}-${date.getDate()}`;
            const specialDayElement = document.getElementById('special-day');
            if (specialDays[monthDay]) {
                specialDayElement.textContent = `üéâ ${specialDays[monthDay]}`;
                specialDayElement.classList.remove('hidden');
            } else {
                specialDayElement.classList.add('hidden');
            }
        }

        // Update clock every second
        setInterval(updateClock, 1000);

        // --- Weather and AQI ---
        const WEATHER_API_URL = 'https://api.open-meteo.com/v1/forecast';
        const AQI_API_URL = 'https://air-quality-api.open-meteo.com/v1/air-quality';
        const LATITUDE = 8.4869; // Thiruvananthapuram
        const LONGITUDE = 76.9366; // Thiruvananthapuram
        const TIMEZONE = 'Asia%2FKolkata';

        // Map Open-Meteo weather codes to emojis, descriptions, and FAVICON NAMES (updated with your list)
        const weatherCodeMap = {
            0: { emoji: '‚òÄÔ∏è', description: 'Clear sky', favicon: 'clear_day' },
            1: { emoji: 'üå§Ô∏è', description: 'Mainly clear', favicon: 'clear_day' },
            2: { emoji: '‚õÖ', description: 'Partly cloudy', favicon: 'partly_cloudy_day' },
            3: { emoji: '‚òÅÔ∏è', description: 'Overcast', favicon: 'cloud' },
            45: { emoji: 'üå´Ô∏è', description: 'Fog', favicon: 'foggy' },
            48: { emoji: 'üå´Ô∏è', description: 'Depositing rime fog', favicon: 'foggy' },
            51: { emoji: 'üåßÔ∏è', description: 'Light drizzle', favicon: 'rainy_light' },
            53: { emoji: 'üåßÔ∏è', description: 'Moderate drizzle', favicon: 'rainy_light' },
            55: { emoji: 'üåßÔ∏è', description: 'Dense drizzle', favicon: 'rainy_light' },
            56: { emoji: 'üåßÔ∏è‚ùÑÔ∏è', description: 'Light freezing drizzle', favicon: 'rainy_light' },
            57: { emoji: 'üåßÔ∏è‚ùÑÔ∏è', description: 'Dense freezing drizzle', favicon: 'rainy_light' },
            61: { emoji: '‚òî', description: 'Slight rain', favicon: 'rainy_light' },
            63: { emoji: 'üåßÔ∏è', description: 'Moderate rain', favicon: 'rainy' },
            65: { emoji: '‚õàÔ∏è', description: 'Heavy rain', favicon: 'rainy_heavy' },
            66: { emoji: 'üåßÔ∏è‚ùÑÔ∏è', description: 'Light freezing rain', favicon: 'rainy_light' },
            67: { emoji: 'üåßÔ∏è‚ùÑÔ∏è', description: 'Heavy freezing rain', favicon: 'rainy_heavy' },
            71: { emoji: 'üå®Ô∏è', description: 'Slight snow fall', favicon: 'snowing' },
            73: { emoji: 'üå®Ô∏è', description: 'Moderate snow fall', favicon: 'rainy_snow' },
            75: { emoji: '‚ùÑÔ∏è', description: 'Heavy snow fall', favicon: 'snowing_heavy' },
            77: { emoji: '‚ùÑÔ∏è', description: 'Snow grains', favicon: 'weather_snowy' },
            80: { emoji: '‚õàÔ∏è', description: 'Slight rain showers', favicon: 'rainy_light' },
            81: { emoji: '‚õàÔ∏è', description: 'Moderate rain showers', favicon: 'rainy' },
            82: { emoji: '‚õàÔ∏è', description: 'Violent rain showers', favicon: 'rainy_heavy' },
            85: { emoji: 'üå®Ô∏è', description: 'Slight snow showers', favicon: 'sunny_snowing' },
            86: { emoji: 'üå®Ô∏è', description: 'Heavy snow showers', favicon: 'snowing_heavy' },
            95: { emoji: '‚ö°‚õàÔ∏è', description: 'Thunderstorm', favicon: 'thunderstorm' },
            96: { emoji: '‚ö°‚õàÔ∏è', description: 'Thunderstorm with slight hail', favicon: 'thunderstorm' },
            99: { emoji: '‚ö°‚õàÔ∏è', description: 'Thunderstorm with heavy hail', favicon: 'weather_hail' },
        };

        function getWeatherEmoji(code) {
            return weatherCodeMap[code] ? weatherCodeMap[code].emoji : '‚ùì';
        }

        function getWeatherDescription(code) {
            return weatherCodeMap[code] ? weatherCodeMap[code].description : 'Unknown';
        }

        // Function to update the favicon
        function updateFavicon(weatherCode) {
            const faviconLink = document.getElementById('favicon');
            // Get the specific icon name from your updated map
            const iconName = weatherCodeMap[weatherCode] ? weatherCodeMap[weatherCode].favicon : 'question_mark';

            // Construct the URL for the Material Symbols icon as a favicon
            // Using a specific version (v164) of the woff2 file from Google Fonts.
            // The `text` parameter is crucial here to specify which icon glyph to render.
            // `fill=1` makes the icon solid (filled) rather than outlined.
            faviconLink.href = `https://fonts.gstatic.com/s/materialsymbolsoutlined/v164/kJFvBWEMp-mm5WnkfEE_EVdTYXJgZ.woff2?text=${iconName}&fill=1`;
        }

        async function fetchWeather() {
            document.getElementById('current-weather-display').classList.add('hidden');
            document.getElementById('current-weather-loading').classList.remove('hidden');
            document.getElementById('current-weather-error').classList.add('hidden');

            document.getElementById('forecast-display').innerHTML = ''; // Clear previous forecast
            document.getElementById('forecast-loading').classList.remove('hidden');
            document.getElementById('forecast-error').classList.add('hidden');

            try {
                // Fetch current weather and 3-day forecast
                const weatherResponse = await fetch(`${WEATHER_API_URL}?latitude=${LATITUDE}&longitude=${LONGITUDE}&current=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=${TIMEZONE}&forecast_days=4`);
                const weatherData = await weatherResponse.json();

                if (!weatherResponse.ok) {
                    throw new Error(weatherData.reason || 'Failed to fetch weather data');
                }

                const current = weatherData.current;
                const daily = weatherData.daily;

                // Update Current Weather
                document.getElementById('current-temp').textContent = `${Math.round(current.temperature_2m)}¬∞C`;
                document.getElementById('weather-emoji').textContent = getWeatherEmoji(current.weather_code);
                document.getElementById('weather-description').textContent = getWeatherDescription(current.weather_code);
                document.getElementById('wind-speed').textContent = `${current.wind_speed_10m.toFixed(1)} km/h`;
                document.getElementById('humidity').textContent = `${current.relative_humidity_2m}%`;
                document.getElementById('rainfall').textContent = `${current.precipitation.toFixed(1)} mm`;

                // *** Call the favicon update function with the current weather code ***
                updateFavicon(current.weather_code);

                // Fetch AQI
                const aqiResponse = await fetch(`${AQI_API_URL}?latitude=${LATITUDE}&longitude=${LONGITUDE}&current=european_aqi&timezone=${TIMEZONE}`);
                const aqiData = await aqiResponse.json();

                if (aqiResponse.ok && aqiData.current && aqiData.current.european_aqi !== undefined) {
                    document.getElementById('aqi').textContent = `${Math.round(aqiData.current.european_aqi)}`;
                } else {
                    document.getElementById('aqi').textContent = 'N/A';
                    console.warn('Could not fetch AQI data or AQI is undefined.');
                }

                document.getElementById('current-weather-display').classList.remove('hidden');
                document.getElementById('current-weather-loading').classList.add('hidden');


                // Update 3-Day Forecast
                const forecastDisplay = document.getElementById('forecast-display');
                forecastDisplay.innerHTML = ''; // Clear previous content

                // Loop for next 3 days (index 1, 2, 3 as 0 is today)
                for (let i = 1; i <= 3; i++) {
                    const date = new Date(daily.time[i]);
                    const dayName = date.toLocaleDateString('en-IN', { weekday: 'short' });
                    const maxTemp = Math.round(daily.temperature_2m_max[i]);
                    const minTemp = Math.round(daily.temperature_2m_min[i]);
                    const weatherCode = daily.weather_code[i];

                    const forecastItem = document.createElement('div');
                    forecastItem.className = 'weather-forecast-item';
                    forecastItem.innerHTML = `
                        <span class="font-medium text-gray-200">${dayName}</span>
                        <span class="text-2xl">${getWeatherEmoji(weatherCode)}</span>
                        <span class="text-gray-300">${getWeatherDescription(weatherCode)}</span>
                        <span class="font-semibold text-white">${maxTemp}¬∞C / ${minTemp}¬∞C</span>
                    `;
                    forecastDisplay.appendChild(forecastItem);
                }
                document.getElementById('forecast-loading').classList.add('hidden');

            } catch (error) {
                console.error('Error fetching weather data:', error);
                document.getElementById('current-weather-error').textContent = `Error: ${error.message}`;
                document.getElementById('current-weather-error').classList.remove('hidden');
                document.getElementById('current-weather-loading').classList.add('hidden');

                document.getElementById('forecast-error').textContent = `Error: ${error.message}`;
                document.getElementById('forecast-error').classList.remove('hidden');
                document.getElementById('forecast-loading').classList.add('hidden');
            }
        }

        // Fetch weather data every 10 minutes (600000 ms)
        setInterval(fetchWeather, 600000);
    </script>
</body>
</html>